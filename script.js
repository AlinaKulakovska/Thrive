const pecipeList = [{
    "idMeal": "1",
    "strMealThumb": "https://www.tastingtable.com/img/gallery/penne-arrabiata-recipe-best-pasta-recipes-spicy-tomato-sauce/penne-arrabiata-recipe-1641224585.jpg",
    "rating": "4.5",
    "reviews": "34",
    "strMeal": "Spicy Arrabiata Penne",
    "time": "30 min",
    "hardness": "easy",
    "strCategory": "Vegetarian",
    "strInstructions": "Bring a large pot of water to a boil. Add kosher salt to the boiling water, then add the pasta. Cook according to the package instructions, about 9 minutes.\r\nIn a large skillet over medium-high heat, add the olive oil and heat until the oil starts to shimmer. Add the garlic and cook, stirring, until fragrant, 1 to 2 minutes. ",
    "Ingridiensts": "<li>Rice - 250g</li><li>water - 500ms</li><li>egg</li>",
    "Nutrition": "250cal|54g|23g|17g",
    "Price": "$25"
},
{
    "idMeal": "2",
    "strMeal": "Teriyaki Chicken Casserole",
    "strMealThumb": "https://kikkomanusa.com/homecooks/wp-content/uploads/2022/02/Teriyaki-Chicken-Casserole-Photo-Site.jpg",
    "rating": "2",
    "reviews": "16",
    "time": "20 min",
    "hardness": "medium",
    "strCategory": "Non-vegan",
    "strInstructions": "Preheat oven to 350\u00b0 F. Spray a 9x13-inch baking pan with non-stick spray.\r\nCombine soy sauce, \u00bd cup water, brown sugar, ginger and garlic in a small saucepan and cover.  ",
    "Ingridiensts": "<li>chicken - 250g</li><li>water - 500ms</li><li>eggs - 2</li>",
    "Nutrition": "350cal|15g|23g|21g",
    "Price": "$24"
},
{
    "idMeal": "3",
    "strMealThumb": "https://mma.prnewswire.com/media/2045665/Tim_Hortons_April_1_Alert__Tim_Hortons_testing_Square_Timbits_at.jpg?p=twitter",
    "rating": "3",
    "reviews": "1",
    "strMeal": "Timbits",
    "time": "90 min",
    "hardness": "hard",
    "strCategory": "Dessert",
    "strInstructions": "Sift together dry ingredients.\r\nMix together wet ingredients and incorporate into dry. Stir until smooth.\r\nDrop by teaspoonfuls(no bigger) into hot oil (365 degrees, no hotter), ",
    "Ingridiensts": "<li>flour - 250g</li><li>water - 500ms</li><li>eggs - 2</li>",
    "Nutrition": "250cal|54g|33g|17g",
    "Price": "$14"
},
{
    "idMeal": "4",
    "strMeal": "Cevapi Sausages",
    "strMealThumb": "https://www.seriouseats.com/thmb/2uspI5RtmIyXYVCbCgs1ljl8Fks=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/20230307-SEA-Kedgeree-AmandaSuarez-17-a311881136f14c34bfad1d0d6c246cee.JPG",
    "rating": "1",
    "reviews": "14",
    "time": "10 min",
    "hardness": "easy",
    "strCategory": "Vegetarian",
    "strInstructions": "Preheat oven to 350\u00b0 F. Spray a 9x13-inch baking pan with non-stick spray.\r\nCombine soy sauce, \u00bd cup water, brown sugar, ginger and garlic in a small saucepan and cover.  ",
    "Ingridiensts": "<li>Onion - 50g</li><li>Fish -250g</li><li>Lemon - 1/2</li>",
    "Nutrition": "150cal|15g|23g|21g",
    "Price": "$20"
},
{
    "idMeal": "5",
    "strMealThumb": "https://www.allrecipes.com/thmb/GwdML2o-xsFGnHTEp-uy7RWMEOc=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/166638-baked-buffalo-wings-ddmfs-beauty-3x4-90787930d20b402e9dde79c22fced332.jpg",
    "rating": "4",
    "reviews": "74",
    "strMeal": "Spicy Chicken Wings",
    "time": "40 min",
    "hardness": "easy",
    "strCategory": "Non-Vegan",
    "strInstructions": "Bring a large pot of water to a boil. Add kosher salt to the boiling water, then add the pasta. Cook according to the package instructions, about 9 minutes.\r\nIn a large skillet over medium-high heat, add the olive oil and heat until the oil starts to shimmer. Add the garlic and cook, stirring, until fragrant, 1 to 2 minutes. ",
    "Ingridiensts": "<li>Chicken Wings - 250g</li><li>oil - 500ms</li><li>egg</li>",
    "Nutrition": "250cal|54g|23g|17g",
    "Price": "$15"
},
{
    "idMeal": "6",
    "strMealThumb": "https://pastaevangelists.com/cdn/shop/articles/Duck_ragu_1200x1200.jpg?v=1590766287",
    "rating": "2.5",
    "reviews": "54",
    "strMeal": "Venetian Duck Ragu",
    "time": "45 min",
    "hardness": "medium",
    "strCategory": "Non-Vegan",
    "strInstructions": "Heat the oil in a large pan. Add the duck legs and brown on all sides for about 10 mins. Remove to a plate and set aside. Add the onions to the pan and cook for 5 mins until softened. Add the garlic and cook for a further 1 min,",
    "Ingridiensts": "<li>Duck Legs - 250g</li><li>Parmesan Cheese - 140g</li><li>Garlic</li>",
    "Nutrition": "250cal|24g|33g|18g",
    "Price": "$15"
},
{
    "idMeal": "7",
    "strMealThumb": "https://www.thespruceeats.com/thmb/48MwYE_xzZnw31K4_Z81fw0FxrA=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/traditional-scottish-dundee-cake-recipe-435067-hero-02-41514a0a054d486990fb3910fc7ec1b6.jpg",
    "rating": "5.5",
    "reviews": "124",
    "strMeal": "Dundee cake",
    "time": "60 min",
    "hardness": "hard",
    "strCategory": "Dessert",
    "strInstructions": "Put the almonds into a small bowl and pour over boiling water to just cover. Leave for 5 mins then drain in a sieve and leave to dry.\r\nPreheat the oven to 180C\/160 C fan\/Gas Mark 4.",
    "Ingridiensts": "<li>Almonds - 250g</li><li>Butter - 140g</li><li>Muscovado Sugar - 350g</li>",
    "Nutrition": "350cal|54g|12g|47g",
    "Price": "$10"
},
];
// creates last card random meal 
fetch('https://www.themealdb.com/api/json/v1/1/random.php')
    .then(res => res.json())
    .then(data => {
        pecipeList.push((data.meals[0]))
        cards(pecipeList)
        console.log(pecipeList)
    })
    .catch(err => {
        console.error(err);
    });
const outputElement = document.getElementById('output');



// crate post
function createpost() {
    document.getElementById("modal").classList.remove("hidden")
}
document.getElementById("close").addEventListener("click", () => {
    document.getElementById("modal").classList.add("hidden")
})
document.getElementById("submit").addEventListener("click", () => {
    let x = { "strCategory":  document.getElementById("Category").value,"strInstructions": document.getElementById("Instructions").value, "strMeal": document.getElementById("name").value, "strMealThumb": document.getElementById("thumb").value};
    pecipeList.push(x)
    cards(pecipeList)
    document.getElementById("modal").classList.add("hidden")
})


// Search
const input = document.getElementById('Search');

input.addEventListener("search", () => {
    var newarray = []
    for (let i = 0; i < pecipeList.length; i++) {
        if (pecipeList[i].strMeal.includes(input.value)) {
            newarray.push(pecipeList[i])

        }
    }
    cards(newarray);
});


// vegan
const vegan = document.getElementById('vegan');
var setVegan = false;
vegan.addEventListener("click", () => {
    var newarrayvegan = []
    if (setVegan === false) {
        for (let i = 0; i < pecipeList.length; i++) {
            if (pecipeList[i].strCategory.includes("Vegetarian")) {
                newarrayvegan.push(pecipeList[i]);
            }
        }
        setVegan = true;
        cards(newarrayvegan);
    } else {
        setVegan = false;
        cards(pecipeList);
    }

});
function sortRicent() {
    cards(pecipeList);
}

// sort by time
function sortTime() {
    let sortTime = [...pecipeList];
    sortTime.sort((a, b) => {
        if (a.time < b.time) {
            return -1;
        }
    });
    cards(sortTime);
}
//  cards
function cards(array) {
    document.getElementById("paginated-list").innerHTML = "";
    if (array.length == 0) {
        document.getElementById("paginated-list").innerHTML = "<h1>Nothing Found</h1>"
    }
    for (let i = 0; i < array.length; i++) {

        let meal = document.createElement("li");
        document.getElementById("paginated-list").appendChild(meal);
        meal.classList.add("li", "meal_card");
        let rating = document.createElement("div");
        rating.classList.add("card_rating");

        for (let x = 0; x < 5; x++) {
            if (x >= array[i].rating) {
                let img = document.createElement("img");
                img.style.height = "15px";
                img.src = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSsmn6LPTD6BY0te9Qk_9jM_mOBcbVn8lae9w&usqp=CAU";
                rating.append(img)
            } else {
                let img = document.createElement("img");
                img.style.height = "15px";
                img.src = "https://freeiconshop.com/wp-content/uploads/edd/star-curved-outline-filled.png";
                rating.append(img)
            };
        }

        const card_list = document.createElement("div");
        card_list.insertAdjacentHTML("beforeend", `
    <a href="./meal.html" class="meal_link">
        <img src="${array[i].strMealThumb ? array[i].strMealThumb : ""}" class="card_img">
            <div class="card_rating">

               ${rating.innerHTML ? rating.innerHTML : ""}
                    ${array[i].reviews ? array[i].reviews : ""} Ratings
            </div>
        </img>
        <div class="card_body">
            <div class="card_name">
                ${array[i].strMeal ? array[i].strMeal : ""}
            </div>
            <div class="card_properties">
                <div class="properties_circle"><img
                        src="https://cdn-icons-png.flaticon.com/512/826/826165.png" width="25px" alt="">
                </div>${array[i].time ? array[i].time : "No data"}
                <div class="properties_circle"><img
                        src="https://cdn-icons-png.flaticon.com/512/7780/7780470.png" width="25px"
                        alt="">
                </div>${array[i].hardness ? array[i].hardness : "No data"}
                <div class="properties_circle"><img
                        src="https://cdn-icons-png.flaticon.com/512/5627/5627100.png" width="25px"
                        alt="">
                </div>${array[i].strCategory ? array[i].strCategory : "No data"}
            </div>

                <p class="card_description">${array[i].strInstructions ? array[i].strInstructions : ""}
                </p>
                <ul class="card_list">
                ${array[i].Ingridiensts ? array[i].Ingridiensts : ["<li>" + array[i].strIngredient1 + " - " + array[i].strMeasure1 + "</li>" + "<li>" + array[i].strIngredient2 + " - " + array[i].strMeasure2 + "</li>" + "<li>" + array[i].strIngredient3 + " - " + array[i].strMeasure3 + "</li>"]}
                </ul>

            <div class="card_nurtition_price">
                <div class="nutrition">${array[i].Nutrition ? array[i].Nutrition : "No data"}</div>
                <div class="price"><b>${array[i].Price ? array[i].Price : ""}</b></div>
            </div>
        </div>
    </a>`,
            meal.append(card_list)
        );

        // link
        const link = document.querySelectorAll(".meal_link");
        for (let i = 0; i < link.length; i++) {
            link[i].addEventListener("click", () => {
                localStorage.setItem("id", pecipeList[i].idMeal);
                localStorage.setItem("strInstructions", pecipeList[i].strInstructions)
                localStorage.setItem("strMealThumb", pecipeList[i].strMealThumb)
                localStorage.setItem("Ingridiensts", pecipeList[i].Ingridiensts)
            })
        }
    } pagination()
}

function pagination() {
    document.getElementById("pagination-numbers").innerHTML = ""
    // pagination
    const paginationNumbers = document.getElementById("pagination-numbers");
    const paginatedList = document.getElementById("paginated-list");
    const listItems = paginatedList.querySelectorAll(".li");
    const nextButton = document.getElementById("next-button");
    const prevButton = document.getElementById("prev-button");

    const paginationLimit = 3;
    const pageCount = Math.ceil(listItems.length / paginationLimit);
    let currentPage = 1;

    const disableButton = (button) => {
        button.classList.add("disabled");
        button.setAttribute("disabled", true);
    };

    const enableButton = (button) => {
        button.classList.remove("disabled");
        button.removeAttribute("disabled");
    };

    const handlePageButtonsStatus = () => {
        if (currentPage === 1) {
            disableButton(prevButton);
        } else {
            enableButton(prevButton);
        }

        if (pageCount === currentPage) {
            disableButton(nextButton);
        } else {
            enableButton(nextButton);
        }
    };

    const handleActivePageNumber = () => {
        document.querySelectorAll(".pagination-number").forEach((button) => {
            button.classList.remove("active");
            const pageIndex = Number(button.getAttribute("page-index"));
            if (pageIndex == currentPage) {
                button.classList.add("active");
            }
        });
    };

    const appendPageNumber = (index) => {
        const pageNumber = document.createElement("button");
        pageNumber.className = "pagination-number";
        pageNumber.innerHTML = index;
        pageNumber.setAttribute("page-index", index);
        pageNumber.setAttribute("aria-label", "Page " + index);

        paginationNumbers.appendChild(pageNumber);
    };

    const getPaginationNumbers = () => {
        for (let i = 1; i <= pageCount; i++) {
            appendPageNumber(i);
        }
    };

    const setCurrentPage = (pageNum) => {
        currentPage = pageNum;

        handleActivePageNumber();
        handlePageButtonsStatus();

        const prevRange = (pageNum - 1) * paginationLimit;
        const currRange = pageNum * paginationLimit;

        listItems.forEach((item, index) => {
            item.classList.add("hidden");
            if (index >= prevRange && index < currRange) {
                item.classList.remove("hidden");
            }
        });
    };


    getPaginationNumbers();
    setCurrentPage(1);

    prevButton.addEventListener("click", () => {
        setCurrentPage(currentPage - 1);
    });

    nextButton.addEventListener("click", () => {
        setCurrentPage(currentPage + 1);
    });

    document.querySelectorAll(".pagination-number").forEach((button) => {
        const pageIndex = Number(button.getAttribute("page-index"));

        if (pageIndex) {
            button.addEventListener("click", () => {
                setCurrentPage(pageIndex);
            });
        }
    });

}

window.onload = cards(pecipeList);
